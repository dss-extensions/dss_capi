image: Visual Studio 2017
clone_folder: c:\dss_capi
environment:
    PYTHON_DIR: "C:\\Python39-x64"

build_script:
  - cmd: "SET PATH=%PYTHON_DIR%;%PYTHON_DIR%\\Scripts;%PATH%"
  - cmd: "python -V"
  - cmd: "'c:\\Program Files\\Git\\bin\\bash' -c 'bash ./make_metadata.sh'"
  - cmd: "appveyor downloadfile https://sourceforge.net/projects/freepascal/files/Win32/3.2.0/fpc-3.2.0.i386-win32.exe/download -FileName fpc-3.2.0.i386-win32.exe"
  - cmd: "appveyor downloadfile https://sourceforge.net/projects/freepascal/files/Win32/3.2.0/fpc-3.2.0.i386-win32.cross.x86_64-win64.exe/download -FileName fpc-3.2.0.i386-win32.cross.x86_64-win64.exe"
  - cmd: "appveyor downloadfile https://github.com/dss-extensions/klusolve/releases/download/1.1.0a2/klusolve_1.1.0a2_win_x86-msvc2017.zip -FileName klusolve_x86.zip"

deploy:
- provider: GitHub
  auth_token:
    secure: 1eYtGksCZWZwjLNNMl5yjUoCDdEg9z1/6DdnR7fSU2wWUcKkp0Hpy0K2uvVYYEWK
  artifact: /.*\.zip/
  draft: true
  force_update: true
  on:
    APPVEYOR_REPO_TAG: true
